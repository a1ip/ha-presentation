<!DOCTYPE HTML>
<html lang="en">
<head>
    <title>Аппаратное ускорение в жизни верстальщика</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=792, user-scalable=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="stylesheet" href="shower/themes/ribbon/styles/screen.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body class="list">
<header class="caption">
    <h1>Fronttalks</h1>
    <p>Аппаратное ускорение в жизни верстальщика</p>
</header>

<section class="slide shout">
    <div style="text-align: center">
        <h2 style="font-size: 370%">Аппаратное ускорение в жизни верстальщика</h2>
        <div style="font-size: 150%"><span style="color:red">Я</span>ндекс</div>
        <div style="margin:300px 0 0;"><span style="color:red">З</span>авьялов <span style="color:red">А</span>лександр
        </div>
    </div>
</section>

<section class="slide cover">
    <h2 class="b-demo-head">Demo</h2>
    <video src="video/demo.webm" controls="controls" width="100%"></video>
</section>

<section class="slide">
    <div>
        <h2>FPS</h2>
        <ul>
            <li>Средняя частота обновления 50...60 Hz</li>
            <li>RequestAnimationFrame() вместо setTimeout()</li>
            <li>Новый кадр каждые ~16.6ms</li>
        </ul>
        <img src="pictures/monitors.jpg" style="margin:-90px 0 0 510px;width: 440px;">
    </div>
</section>

<section class="slide">
    <div>
        <h2>Chrome Timeline</h2>
        <ul>
            <li>Мы - виртуозы создания помех</li>
        </ul>
        <img src="pictures/jank.png" style="margin: -20px 0 0 -90px;">
    </div>
</section>

<section class="slide cover">
    <div>
        <h2 style="color:#fff;display:inline-block;text-shadow: 0 0 16px #000;">От разметки к изображению</h2>
        <span style="color:#fff;text-shadow: 0 0 16px #000;"> (как это было)</span>
        <img src="simpsons/render-past.jpg" style="" alt=""/>
    </div>
</section>

<section class="slide b-dom-1-slide">
    <div>
        <h2>Лучшая в мире страничка</h2>
        <img src="pictures/piar.png" alt=""/>
    </div>
</section>

<section class="slide b-dom-1-slide">
    <div>
        <h2>От разметки к изображению</h2>
        <div style="position:relative">
            <pre class="b-html-code">
                <code>&lt;!DOCTYPE html&gt;</code>
                <code>&lt;html&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Пиар самого себя&lt;/title&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta charset="utf-8"&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;link rel="stylesheet" href="main.css"&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;section&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h1&gt;Всем привет!&lt;/h1&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;img src="i.jpg" alt="Я"&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Я занимаюсь фронтенд разработкой.&lt;/p&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;И это круто!&lt;/p&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/section&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script src="main.js"&gt;&lt;/script&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;</code>
                <code>&lt;/html&gt;</code>
            </pre>
            <div class="next b-dom-tags">
                <div class="b-dom-tag b-dom-tag_html">html</div>
                <div class="b-dom-tag b-dom-tag_head">head</div>
                <div class="b-dom-tag b-dom-tag_title">title</div>
                <div class="b-dom-tag b-dom-tag_meta">meta</div>
                <div class="b-dom-tag b-dom-tag_link">link</div>
                <div class="b-dom-tag b-dom-tag_body">body</div>
                <div class="b-dom-tag b-dom-tag_section">section</div>
                <div class="b-dom-tag b-dom-tag_h1">h1</div>
                <div class="b-dom-tag b-dom-tag_img">img</div>
                <div class="b-dom-tag b-dom-tag_p_1">p</div>
                <div class="b-dom-tag b-dom-tag_p_2">p</div>
                <div class="b-dom-tag b-dom-tag_script">script</div>
            </div>
        </div>
    </div>
</section>

<section class="slide b-dom-2-slide">
    <div>
        <h2>DOM Tree</h2>
        <div style="position:relative">
            <pre class="b-html-code">
                <code>&lt;!DOCTYPE html&gt;</code>
                <code>&lt;html&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;head&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;Пиар самого себя&lt;/title&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta charset="utf-8"&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;link rel="stylesheet" href="main.css"&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/head&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;body&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;section&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h1&gt;Всем привет!&lt;/h1&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;img src="i.jpg" alt="Я"&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;Я занимаюсь фронтенд разработкой.&lt;/p&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p&gt;И это круто!&lt;/p&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/section&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;script src="main.js"&gt;&lt;/script&gt;</code>
                <code>&nbsp;&nbsp;&nbsp;&nbsp;&lt;/body&gt;</code>
                <code>&lt;/html&gt;</code>
            </pre>
            <img src="pictures/dom-lines.png" class="b-dom-lines">
            <div class="b-dom-tags">
                <div class="b-dom-tag b-dom-tag_html">html</div>
                <div class="b-dom-tag b-dom-tag_head">head</div>
                <div class="b-dom-tag b-dom-tag_title">title</div>
                <div class="b-dom-tag b-dom-tag_meta">meta</div>
                <div class="b-dom-tag b-dom-tag_link">link</div>
                <div class="b-dom-tag b-dom-tag_body">body</div>
                <div class="b-dom-tag b-dom-tag_section">section</div>
                <div class="b-dom-tag b-dom-tag_h1">h1</div>
                <div class="b-dom-tag b-dom-tag_img">img</div>
                <div class="b-dom-tag b-dom-tag_p_1">p</div>
                <div class="b-dom-tag b-dom-tag_p_2">p</div>
                <div class="b-dom-tag b-dom-tag_script">script</div>
            </div>
        </div>
    </div>
</section>

<section class="slide b-dom-3-slide">
    <div>
        <h2>DOM Tree + CSS</h2>
        <div style="position:relative">
            <img src="pictures/dom-lines.png" class="b-dom-lines">
            <div class="b-css next">CSS</div>
            <div class="b-dom">DOM</div>
            <div class="b-dom-tags">
                <div class="b-dom-tag b-dom-tag_html">html</div>
                <div class="b-dom-tag b-dom-tag_head">head</div>
                <div class="b-dom-tag b-dom-tag_title">title</div>
                <div class="b-dom-tag b-dom-tag_meta">meta</div>
                <div class="b-dom-tag b-dom-tag_link">link</div>
                <div class="b-dom-tag b-dom-tag_body">body</div>
                <div class="b-dom-tag b-dom-tag_section">section</div>
                <div class="b-dom-tag b-dom-tag_h1">h1</div>
                <div class="b-dom-tag b-dom-tag_img">img</div>
                <div class="b-dom-tag b-dom-tag_p_1">p</div>
                <div class="b-dom-tag b-dom-tag_p_2">p</div>
                <div class="b-dom-tag b-dom-tag_script">script</div>
            </div>
            <div class="b-dom-css-plus">+</div>
        </div>
    </div>
</section>

<section class="slide b-render-slide">
    <div>
        <h2>RenderTree</h2>
        <div style="position:relative">
            <div class="b-render-tags next">
                <div class="b-render-tag b-render-tag_html">html</div>
                <div class="b-render-tag b-render-tag_body">body</div>
                <div class="b-render-tag b-render-tag_section">section</div>
                <div class="b-render-tag b-render-tag_h1">h1</div>
                <div class="b-render-tag b-render-tag_img">img</div>
                <div class="b-render-tag b-render-tag_p_1">p</div>
                <div class="b-render-tag b-render-tag_p_2">p</div>
            </div>
            <img src="pictures/render-lines.png" class="b-render-lines">
            <div class="b-dom">DOM</div>
            <div class="b-dom-css-plus">+</div>
            <div class="b-css">CSS</div>
            <div class="b-render-tree">RenderTree</div>
            <code class="next render-tree-change">
                p::after {<br>
                &nbsp;&nbsp;...<br>
                }
            </code>
            <div class="next">
                <div class="b-render-extra-line b-render-extra-line_1"></div>
                <div class="b-render-extra-line b-render-extra-line_2"></div>
                <div class="b-render-tag b-render-tag_p_1_after">::after</div>
                <div class="b-render-tag b-render-tag_p_2_after">::after</div>
            </div>
        </div>
    </div>
</section>

<section class="slide b-layout-slide">
    <div>
        <h2>Компоновка</h2>
        <div style="position:relative">
            <div class="b-render-tags">
                <div class="b-render-tag b-render-tag_html">html</div>
                <div class="b-render-tag b-render-tag_body">body</div>
                <div class="b-render-tag b-render-tag_section">section</div>
                <div class="b-render-tag b-render-tag_h1">h1</div>
                <div class="b-render-tag b-render-tag_img">img</div>
                <div class="b-render-tag b-render-tag_p_1">p</div>
                <div class="b-render-tag b-render-tag_p_2">p</div>
            </div>
            <img src="pictures/render-lines.png" class="b-render-lines">
            <div class="b-layout">
                <div class="b-layout-body">html, body
                    <div class="b-layout-section">section
                        <div class="b-layout-h1">h1</div>
                        <div class="b-layout-img">img</div>
                        <div class="b-layout-p">p</div>
                        <div class="b-layout-p">p</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="slide b-rasterization-slide">
    <div>
        <h2>Отрисовка</h2>
        <img src="pictures/8.png">
    </div>
</section>

<section class="slide cover">
    <h2 class="b-rasterization-head">Отрисовка</h2>
    <video src="video/rasterization.webm" controls="controls" width="100%"></video>
</section>

<section class="slide">
    <div>
        <h2>Отрисовка. «Грязные» области</h2>
        <img src="pictures/10.jpg">
    </div>
</section>

<section class="slide">
    <div>
        <h2>Весь процесс</h2>
        <ol>
            <li class="next">Парсинг HTML</li>
            <li class="next">Парсинг CSS</li>
            <li class="next">DOM Tree</li>
            <li class="next">RenderTree</li>
            <li class="next">Компоновка</li>
            <li class="next" style="font-weight:bold">Отрисовка (страница = растровое изображение)</li>
        </ol>
        <p class="next"><a href="http://www.html5rocks.com/ru/tutorials/internals/howbrowserswork/">Как работают
            браузеры</a></p>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Отрисовка</h2>
        <img src="pictures/9.png">
    </div>
</section>

<section class="slide">
    <div>
        <h2>Скролл</h2>
        <img src="pictures/scroll-cpu.png" style="margin:-24px 0 0 170px;width:490px;" alt=""/>
    </div>
</section>

<section class="slide cover">
    <div>
        <h2 style="color:#fff;display:inline-block;">Compositing</h2><br>
        <img src="simpsons/compositing.jpg" style="width:105%" alt=""/>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Compositing</h2>
        <ol>
            <li class="next">страница делится на слои</li>
            <li class="next">слои растеризуются</li>
            <li class="next">слои выводятся на экран *</li>

            <p class="next">* X Window, Windows API, что есть в ОС</p>
        </ol>
    </div>
</section>

<section class="slide cover">
    <h2 class="b-rasterization-head">Оптимизированный скролл</h2>
    <video src="video/scroll.webm" controls="controls" width="100%"></video>
</section>

<section class="slide cover">
    <div>
        <h2 style="color:#fff;display:inline-block;">GPU Accelerated Compositing</h2>
        <img src="simpsons/gpu-compositing.jpg" style="" alt=""/>
    </div>
</section>

<section class="slide">
    <div>
        <h2>GPU Accelerated Compositing. Вчера.</h2>
        <ul>
            <li>март 2011 года</li>
            <li><b>Firefox 4+</b>, IE 9+, Chrome 8+, Safari 5.1+, Opera 12+</li>
        </ul>
        <img src="simpsons/1.png" style="margin:-30px 0 0 140px">
    </div>
</section>

<section class="slide">
    <style type="text/css">
        td
        {
            vertical-align: middle;
            font-size: 60%;
        }

        th
        {
            vertical-align: middle;
            font-size: 80%;
        }
    </style>
    <div>
        <h2>GPU Accelerated Compositing. Сегодня.</h2>
        <table>
            <thead>
            <tr>
                <th>Браузер</th>
                <th>Проверка</th>
                <th>Отключение</th>
                <th style="text-align:center">По умолчанию</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <th>Firefox</th>
                <td>about:support (graphics section)</td>
                <td>about:config, settings</td>
                <td style="text-align:center">вкл.*</td>
            </tr>
            <tr>
                <th>Chrome</th>
                <td>chrome://gpu</td>
                <td>cli options</td>
                <td style="text-align:center">вкл.*</td>
            </tr>
            <tr>
                <th>IE9+</th>
                <td>-</td>
                <td>tools > internet option</td>
                <td style="text-align:center">вкл.*</td>
            </tr>
            <tr>
                <th>Safari</th>
                <td>-</td>
                <td>menu -> debug<br>cli options</td>
                <td style="text-align:center">вкл.*</td>
            </tr>
            <tr>
                <th>Opera</th>
                <td>opera:gpu</td>
                <td>opera:config</td>
                <td style="text-align:center">вкл.* (webkit)</td>
            </tr>
            </tbody>
        </table>
        <div>Мобильные: iOS6+, Android4+, Windows Phone 7 (IE9)</div>
        <p style="font-size:70%"><b>*</b> - драйвер</p>

    </div>
</section>

<section class="slide">
    <div>
        <h2>GPU Accelerated Compositing</h2>
        <ol>
            <li class="next">страница делится на слои</li>
            <li class="next">слои растеризуются в текстуры</li>
            <li class="next">текстуры загружаются в GPU</li>
            <li class="next"><i>compositor</i> инструктирует GPU, как собрать конечное изображение</li>
        </ol>
        <img class="next" src="pictures/14.png" style="margin:-47px 0 0 150px">
    </div>
</section>

<section class="slide">
    <div>
        <h2>GPU Accelerated Compositing</h2>
        <img src="pictures/10.png" style="margin-left:-60px">
        <p><a href="http://www.chromium.org/developers/design-documents/gpu-accelerated-compositing-in-chrome">GPU
            Accelerated Compositing in Chrome</a></p>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Слои</h2>
        <p>Слой (композитный слой) - часть страницы, поддерево DOM. <b>Отрисовывается независимо</b>, <b>компонуется в
            GPU</b>. Может
            растягиваться, перемещаться, скрываться (через прозрачность) <b>без отрисовки</b>.</p>
        <p>Paint - дорого<br>Composite - дешево</p>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Слои</h2>
        <span><strong>Условия</strong> создания слоя:</span>
        <ul style="font-size:80%">
            <li class="next">3D transform (go fast hack)</li>
            <li class="next">&lt;video&gt; с включенным h/a</li>
            <li class="next">&lt;canvas&gt; с 3D или 2D с включенным h/a</li>
            <li class="next">плагины (flash, silverlight)</li>
            <li class="next">css анимации opacity или transform</li>
            <li class="next">css фильтры</li>
            <li class="next">элементы, вынесенные над композитным слоем</li>
        </ul>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Дебаг</h2>
        <ul>
            <li>Desktop Webkit: Show composited layer borders</li>
            <li>iOS: XCode, connect to Mac</li>
            <li>Android: connect to PC</li>
        </ul>
        <p><a href="http://www.chromium.org/developers/how-tos/trace-event-profiling-tool">Trace Event Profiling Tool
            (about:tracing)</a>
        </p>
    </div>
</section>

<section class="slide cover">
    <div>
        <h2>Дебаг для взрослых</h2>
        <img src="simpsons/tracing.jpg" style="width:136%;margin-left:-180px;" alt=""/>
        <div>./Applications/Google\ Chrome\ Canary.app/Contents/MacOS/Google\ Chrome\ Canary</div>
        <div style="font-size:80%">
            <div>--enable-threaded-compositing</div>
            <div>--force-compositing-mode</div>
            <div>--enable-impl-side-painting</div>
            <div>--enable-skia-benchmarking</div>
            <div>--allow-webui-compositing</div>
        </div>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Слои для анимаций. Дружелюбный CSS.</h2>
        <ul>
            <li class="next">opacity</li>
            <li class="next">transform</li>
            <li class="next">filter</li>
        </ul>
        <p class="next">Все остальные могут вызвать обновление текстур</p>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Слои для анимаций</h2>
        <p><i>Пример с выезжающим меню (CSS animation)</i></p>
        <ul>
            <li>left (постоянные перерисовки)</li>
            <li>+ translate (2 перерисовки)</li>
            <li>+ translate3d (0 перерисовок)</li>
        </ul>
        <p>Больше примеров!</p>
    </div>
</section>

<section class="slide cover">
    <div>
        <h2>Успех!</h2>
        <img src="simpsons/success.jpg" style="width:120%;margin-left:-100px">
    </div>
</section>

<section class="slide">
    <div>
        <h2>Помним</h2>
        <ul>
            <li class="next"><strong>Память:</strong> узкое место на мобильных</li>
            <li class="next"><strong>Пропускная способность:</strong> легко забить шину CPU <-> GPU</li>
        </ul>
    </div>
</section>

<section class="slide cover">
    <div>
        <h2>Советы</h2>
        <img src="pictures/paint-fast.jpg" style="width:151%;" alt=""/>
        <ol>
            <li class="next">Относитесь к GPU как к кэшу</li>
            <li class="next">Подготавливайте текстуры заранее<br>(переиспользуйте имеющиеся)</li>
            <li class="next">Не создавайте "лишних" слоев</li>
            <li class="next">Для изменения цвета<br>используйте трюк<br>с opacity</li>
        </ol>
    </div>
</section>

<section class="slide cover">
    <div>
        <h2 style="color:#fff">Подводные камни</h2>
        <img src="simpsons/remember.jpg" style="width:109%">
        <ul>
            <li class="next" style="color:#fff">border-radius 50% и overflow:hidden у родителя <strong class="next">(z-index
                родителю)</strong></li>
            <li class="next" style="color:#fff">потеря антиалиасинга шрифта в композитном слое<br><strong class="next">(отказ
                от композитного слоя, +font-size +shadow)</strong></li>
            <li class="next" style="color:#fff">блур текста при трансформации <strong
                    class="next">(background-color,<br>возможно, transform-origin: 50% 51%)</strong></li>
            <li class="next" style="color:#fff">проблемый ресайз SVG в композитном слое в safari<br><strong
                    class="next">(отказ от
                слоя)</strong></li>
        </ul>
    </div>
</section>

<section class="slide">
    <div>
        <h2>Если стало интересно</h2>
        <ul>
            <li><a href="http://jankfree.org/">JankFree.org</a></li>
            <li><a href="http://dev.opera.com/articles/css-will-change-property/">Everything You Need to Know About the
                CSS will-change Property</a></li>
            <li><a href="http://mrsamo.github.io/ha-presentation/index.html">Вот эта вот лекция</a></li>
        </ul>
    </div>
</section>

<section class="slide cover">
    <div>
        <h2 style="text-align: center; color: #fff;">СПАСИБО!</h2>
        <p style="text-align: center; color: #fff;">Twitter:
            <a href="https://twitter.com/alzavyalov" style="color: #fff">alzavyalov</a>
        </p>
        <img src="simpsons/5.gif" width="100%">
    </div>
</section>
<div class="progress">
    <div></div>
</div>
<script src="js/jquery-1.11.1.min.js"></script>
<script src="js/attrchange.js"></script>
<script src="js/main.js"></script>
<script src="shower/shower.min.js"></script>
</body>
</html>